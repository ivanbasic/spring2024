# Quick Test Commands - Lesson 055

## 🚀 Build and Run

```bash
# Clean build
mvn clean install

# Run application
mvn spring-boot:run

# Or run with Maven wrapper
./mvnw spring-boot:run
```

---

## 🧪 Testing Commands

### 1. Test ADMIN (ivan) - Sees All Employees

```bash
# Step 1: Get JWT token
curl -X POST http://localhost:8080/authenticate -u ivan:i

# Step 2: Copy the token from response, then:
curl -X GET http://localhost:8080/db2/employees/my-team \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"

# Expected: All employees from all departments
```

### 2. Test MANAGER ada - Sees Dept 10 Only

```bash
# Step 1: Get JWT token
curl -X POST http://localhost:8080/authenticate -u ada:ada

# Step 2: Use token
curl -X GET http://localhost:8080/db2/employees/my-team \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"

# Expected: Only employees with department_id = 10
# (Ada herself + any other dept 10 employees)
```

### 3. Test MANAGER karl - Sees Dept 20 Only

```bash
# Step 1: Get JWT token
curl -X POST http://localhost:8080/authenticate -u karl:karl

# Step 2: Use token
curl -X GET http://localhost:8080/db2/employees/my-team \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"

# Expected: Only employees with department_id = 20
# (Karl himself + any other dept 20 employees)
```

### 4. Test Regular User (bcryptuser) - Sees Nothing

```bash
# Step 1: Get JWT token
curl -X POST http://localhost:8080/authenticate -u bcryptuser:password

# Step 2: Use token
curl -X GET http://localhost:8080/db2/employees/my-team \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"

# Expected: Empty array []
# (bcryptuser has no employee_id in DB3)
```

---

## 📊 Expected Results Summary

| User | Authority | employee_id | Department | Result |
|------|-----------|-------------|------------|--------|
| ivan | ADMIN | null | - | All employees |
| ada | MANAGER | 1 | 10 | Dept 10 employees only |
| karl | MANAGER | 2 | 20 | Dept 20 employees only |
| bcryptuser | read | null | - | Empty list |

---

## 🐛 Troubleshooting

### Problem: "401 Unauthorized"
- Check username/password
- Verify users exist in DB3
- Check database is running

### Problem: "Empty response"
- Verify DB2 has employees data
- Check employee_id values in DB3 match employee_id in DB2
- Check departments exist in DB2

### Problem: "ClassNotFoundException"
- Run mvn clean install to recompile
- Verify CustomUserDetails.java was created
- Check SecurityConfig imports

### Problem: "SQL Exception"
- Verify schema-db3.sql has employee_id column
- Restart application to apply schema changes
- Check MySQL is running

---

## 📝 Quick Verification Checklist

Before testing:
- [ ] Application builds successfully (mvn clean install)
- [ ] Application starts without errors
- [ ] Can authenticate with ivan:i
- [ ] DB3 (MySQL) is running
- [ ] DB2 (PostgreSQL) is running
- [ ] schema-db3.sql includes employee_id column
- [ ] data-db3.sql includes ada and karl users

---

## 🎯 What to Look For

### Success Indicators:
✅ ivan gets JSON array with ALL employees
✅ ada gets JSON array with ONLY dept 10 employees
✅ karl gets JSON array with ONLY dept 20 employees
✅ bcryptuser gets empty array []
✅ No exceptions in application logs

### Failure Indicators:
❌ 401 Unauthorized errors
❌ 500 Internal Server Error
❌ ClassNotFoundException in logs
❌ SQLException about missing column
❌ All users see same results

---

## 💡 Tips

1. **Copy JWT tokens carefully** - they're long and easy to mess up
2. **Check logs** - Look for INFO lines showing which user called endpoint
3. **Use Postman** - Easier than curl for testing multiple requests
4. **Check databases** - Verify data exists before blaming code

---

**Ready to test!** Start with building the project, then try each user scenario. 🚀
