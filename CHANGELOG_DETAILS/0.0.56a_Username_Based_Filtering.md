# Version 0.0.56 - Username-Based Employee Filtering

## Overview
Link employees to users via `username` instead of `employee_id`. Simpler than Lesson 055.

## Database Changes

**schema-db2.sql:**
```sql
CREATE TABLE schema2.employees (
    employee_id NUMERIC(6),
    first_name VARCHAR(20),
    hire_date TIMESTAMP,
    department_id NUMERIC(4),
    username VARCHAR(50)  -- NEW: Links to DB3.users.username
);
```

**data-db2.sql:**
```sql
INSERT INTO schema2.employees (employee_id, first_name, hire_date, department_id, username)
VALUES (1, 'Ada', '2015-11-21 14:30:15', 1, 'ada');
```

## Service Logic

```java
public List<Employee> getMyTeam(Authentication auth) {
    // ADMIN sees all
    if (auth.getAuthorities().contains(new SimpleGrantedAuthority("SCOPE_ADMIN"))) {
        return employeeRepo.findAll();
    }
    
    // Direct lookup by username
    Employee employee = employeeRepo.findByUsername(auth.getName());
    
    if (employee == null || employee.getDepartment() == null) {
        return Collections.emptyList();
    }
    
    return employeeRepo.findByDepartmentDepartmentId(
        employee.getDepartment().getDepartmentId()
    );
}
```

## Comparison: Lesson 055 vs 056

| Aspect | Lesson 055 (employee_id) | Lesson 056 (username) |
|--------|--------------------------|------------------------|
| **Link** | DB3.users.employee_id → DB2.employees.employee_id | DB3.users.username → DB2.employees.username |
| **Custom Security** | ✅ Required (EmployeeLinkedUserDetails) | ❌ Not needed |
| **Service Complexity** | High (load user, extract ID, lookup) | Low (direct username lookup) |
| **Code Lines** | ~60 | ~20 |

## Why This is Simpler

1. **No custom security classes** - standard Spring Security works
2. **Direct lookup** - `auth.getName()` gives username immediately
3. **Less code** - 3x shorter service method
4. **Works with JWT and Basic Auth** - no special handling needed

## Testing

**Endpoint:** `GET /db2/employees/my-team`

**Expected Results:**

| User | Department | Sees |
|------|------------|------|
| ivan | IT (dept 1) | Ada, Niklaus (all dept 1) |
| ada | IT (dept 1) | Ada, Niklaus (all dept 1) |
| karl | HR (dept 2) | Karl only (all dept 2) |
| bcryptuser | none | Empty list |

## Files Modified

- schema-db2.sql
- data-db2.sql
- Employee.java
- EmployeeRepo.java
- EmployeeService.java
- EmployeeServiceImpl.java
- EmployeeController.java
- pom.xml
- CHANGELOG.md

---

**Key Takeaway:** When you control the database schema, linking by username is simpler than creating custom security classes.